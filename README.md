# MangaLib Parser
**MangaLib Parser** – это кроссплатформенный скрипт для получения данных с семейства сайтов [MangaLib](https://mangalib.me/), [HentaiLib](https://hentailib.me/) и [YaoiLib](https://yaoilib.me/) в JSON. Он позволяет записать всю информацию о конкретной манге, а также её главах и содержании глав в формате [DMP-V1](Examples/DMP-V1.md).  В скрипт также встроен модуль сборки глав в виде ZIP-архивов.

## Порядок установки и использования
1. Скачать и распаковать последний релиз.
2. Убедиться в доступности на вашем устройстве Python версии не старше **3.10**.
3. Открыть каталог со скриптом в терминале: можно воспользоваться командой `cd` или встроенными возможностями файлового менеджера.
4. Создать виртуальное окружение Python.
```
python -m venv .venv
```
5. Активировать вирутальное окружение. 
```
# Для Windows.
.venv\Scripts\activate.bat

# Для Linux или MacOS.
source .venv/bin/activate
```
6. Установить зависимости.
```
pip install -r requirements.txt
```
7. Произвести настройку путём редактирования файла _Settings.json_ и _Proxies.json_.
8. В вирутальном окружении указать для выполнения интерпретатором файл `main.py`, передать ему необходимые параметры и запустить.

# Консольные команды
```
build [FILENAME*] [TARGET] [FLAGS] [KEYS]
```
Собирает из описательного файла архивы глав и помещает их в каталог _Output_ внутри директории скрипта.

**Описание позиций:**
* **FILENAME** – описательный файл, использующийся для сборки. Обязательная позиция.
	* Аргумент – имя файла в директории тайтлов. Можно указывать как с расширением, так и без него.
* **TARGET** – цель внутри описательного файла тайтла для сборки.
	* Флаги:
		* _**--branch**_ – указывает, что необходимо выполнить сборку ветви с переданным ID;
		* _**--chapter**_ – указывает, что необходимо выполнить сборку главы с переданным ID;
		* _**--volume**_ – указывает, что необходимо выполнить сборку тома с переданным номером (автоматически выбирается ветвь с наибольшим количеством глав).

**Список специфических флагов:**
* _**-cbz**_ – указывает, что архивы на выходе должны иметь формат *.CBZ;
* _**-no-delay**_ – отключает интервал между последовательными запросами к серверу;
* _**-no-filters**_ – отключает фильтрацию слайдов размером менее 5 KB.
___
```
getcov [MANGA_SLUG*] [FLAGS]
```
Загружает обложки конкретного тайтла, алиас которого передан в качестве аргумента.

**Список специфических флагов:**
* _**-f**_ – включает перезапись уже загруженных обложек.
___

```
parse [TARGET*] [MODE] [DOMAIN] [FLAGS] [KEYS]
```
Проводит парсинг тайтла с указанным алиасом в JSON формат и загружает его обложки. В случае, если файл тайтла уже существует, дополнит его новыми данными. 

**Описание позиций:**
* **TARGET** – задаёт цель для парсинга. Обязательная позиция.
	* Аргумент – алиас тайтла для парсинга.
	* Флаги:
		* _**-collection**_ – указывает, что список тайтлов для парсинга необходимо взять из файла _Collection.txt_;
		* _**-local**_ – указывает для парсинга все локальные файлы.
* **MODE** – указывает, какие данные необходимо парсить.
	* Флаги:
		* _**-onlydesc**_ – будет произведено обновление только описательных данных тайтла, не затрагивающее ветви перевода и главы.
* **DOMAIN** – указывает, на каком дополнительном домене искать тайтл.
	* Флаги:
		* _**-h**_ – поиск будет произведён на [HentaiLib](https://hentailib.me/);
		* _**-y**_ – поиск будет произведён на [YaoiLib](https://yaoilib.me/).
		
**Список специфических флагов:**
* _**-f**_ – включает перезапись уже загруженных обложек и существующих JSON файлов.

**Список специфических ключей:**
* _**--from**_ – указывает алиас тайтла, с момента обнаружения которого в коллекции тайтлов необходимо начать парсинг.
___
```
repair [FILENAME*] [CHAPTER_ID*]
```
Обновляет и перезаписывает сведения о слайдах конкретной главы в локальном файле.

**Описание позиций:**
* **FILENAME** – имя локального файла, в котором необходимо исправить слайды. Обязательная позиция.
	* Аргумент – имя файла (с расширением или без него).
* **CHAPTER_ID** – ID главы в локальном файле, слайды которой необходимо заново получить с сервера. Обязательная позиция.
	* Ключи:
		* _**--chapter**_ – указывает ID главы.
___
```
update [MODE] [DOMAIN] [FLAGS] [KEYS]
```
Проводит парсинг тайтлов, в которые за интервал времени, указанный в _Settings.json_, были добавлены новые главы.

**Описание позиций:**
* **MODE** – указывает, какие данные необходимо обновлять. Может принимать следующие значения:
	* Флаги:
		* _**-onlydesc**_ – будет произведено обновление только описательных данных тайтла, не затрагивающее ветви перевода и главы.
* **DOMAIN** – указывает, на каком дополнительном домене искать тайтл.
	* Флаги:
		* _**-h**_ – поиск будет произведён на [HentaiLib](https://hentailib.me/);
		* _**-y**_ – поиск будет произведён на [YaoiLib](https://yaoilib.me/).

**Список специфических флагов:**
* _**-f**_ – включает перезапись уже загруженных обложек и существующих JSON файлов.

**Список специфических ключей:**
* _**--from**_ – указывает алиас тайтла, с момента обнаружения которого в списке обновляемых тайтлов необходимо начать обработку обновлений.

## Неспецифические флаги
Данный тип флагов работает при добавлении к любой команде и выполняет отдельную от оной функцию.
* _**-s**_ – выключает компьютер после завершения работы скрипта.

# Settings.json
```JSON
"token": ""
```
Здесь необходимо указать токен аккаунта, взять который можно из заголовков запросов API сайта.
___
```JSON
"use-id-instead-slug": false
```
При включении данного параметра файлы JSON и директория обложки тайтла будут названы по ID произведения, а не по алиасу. При этом уже существующие данные обновляются в автоматическом режиме.
___
```JSON
"check-updates-period": 24
```
Указывает, обновления за какой период времени до запуска скрипта (в часах) нужно получить.
___
```JSON
"titles-directory": ""
```
Указывает, куда сохранять JSON-файлы тайтлов. При пустом значении будет создана папка Titles в исполняемой директории скрипта. Рекомендуется оформлять в соответствии с принципами путей в Linux, описанными [здесь](http://cs.mipt.ru/advanced_python/lessons/lab02.html#cd).
___
```JSON
"covers-directory": ""
```
Указывает, куда сохранять обложки тайтлов. При пустом значении будет создана папка _Covers_ в исполняемой директории скрипта. Рекомендуется оформлять в соответствии с принципами путей в Linux, описанными [здесь](http://cs.mipt.ru/advanced_python/lessons/lab02.html#cd).

> [!NOTE]  
> Некоторые тайтлы недоступны на территории РФ, однако не все прокси подходят для обхода данного ограничения. Используйте прокси стран СНГ и ближнего зарубежья.
___
```JSON
"proxy": {
	"enable": false,
	"host": "",
	"port": "",
	"login": null,
	"password": null
}
```
Указывает HTTPS-прокси для выполнения запросов. Помогает обойти региональные ограничения доступа к сайту.
___
```JSON
"delay": 1
```
Устанавливает интервал в секундах между последовательными запросами к серверу.

_Copyright © DUB1401. 2022-2024._
